CONST OBM_MOUSE=$7000CONST GWL_STYLE=$fffffff0CONST _BufSize=32TYPE ControlStruct	ControlHandle AS HANDLE	ControlInstance AS LONG	ControlID AS LONG	ControlDC AS DC	ControlParent AS HANDLE	ControlText AS STRING*32	ControlLeft AS LONG	ControlTop AS LONG	ControlWidth AS LONG	ControlHeight AS LONG	ControlValue AS LONG	ControlStyle AS LONG	ControlExStyle AS LONG	ControlBackColor AS LONG	ControlForeColor AS LONG	ControlEnabled AS BOOLEAN	ControlMouseXPos AS LONG	ControlMouseYPos AS LONG	ControlCallBack AS LABEL	ControlCallBackSet AS BOOLEANEND TYPEDIM ControlData AS ControlStruct VECTORDIM CreateData AS CreateStruct VECTORDIM RectLeftSafe AS LONGDIM RectTopSafe AS LONGDIM CaptureDC AS DCDIM CaptureRight AS LONGDIM CaptureBottom AS LONGDIM ControlDCTemp AS DCDIM MemDC AS DCDIM Brush AS SOLIDBRUSHDIM Pen AS PENDIM Capture AS BOOLEANDIM TempInt AS LONGDIM MoveState AS LONGDIM Color1 AS LONGDIM Color2 AS LONGDIM I AS LONGDIM J AS LONGSETCLASSNAME OBCanvasDECLARE FCN GetVersion(INTEGER) AS INTEGERBEGIN EXPORT	GetVersionEND EXPORTBEGIN SUB ProcessMsgIF wmsg<>WM_CREATE THEN	CALL SUB GetInstanceVars	GETWINDOWLONG hwnd,GWL_STYLE	IF STATUS<>ControlData.ControlStyle THEN		ControlData.ControlStyle=STATUS		CALL SUB SetControlStyle	END IFEND IFSELECT CASE wmsg	CASE WM_CREATE		ControlData.ControlHandle=hwnd		ControlData.ControlInstance=CreateData.cshInstance		ControlData.ControlID=CreateData.cshMenu		ControlData.ControlParent=CreateData.cshwndParent		ControlData.ControlLeft=CreateData.csLeft		ControlData.ControlTop=CreateData.csTop		ControlData.ControlWidth=CreateData.csWidth		ControlData.ControlHeight=CreateData.csHeight		ControlData.ControlStyle=CreateData.csStyle		ControlData.ControlExStyle=CreateData.csExStyle		ControlData.ControlEnabled=TRUE				CALL SUB GetInstanceVars				ControlData.ControlBackColor=$ffffff		ControlData.ControlForeColor=0		CALL SUB SetControlStyle	CASE WM_MOVE		ControlData.ControlMouseXPos=wparam		ControlData.ControlMouseYPos=lparam		GETWINDOWRECT ControlData.ControlParent		RectLeftSafe=RectLeft		RectTopSafe=RectTop		GETWINDOWRECT hwnd		ControlData.ControlLeft=RectLeft-RectLeftSafe		ControlData.ControlTop=RectTop-RectTopSafe		CALL SUB GetInstanceVars		INVALIDATERECT hwnd		RETURNCODE 0	CASE WM_SIZE		GETCLIENTRECT hwnd		ControlData.ControlWidth=RectRight		ControlData.ControlHeight=RectBottom		CALL SUB GetInstanceVars		INVALIDATERECT hwnd		RETURNCODE 0	CASE OBM_SETCALLBACK		ControlData.ControlCallBackSet=TRUE		ControlData.ControlCallBack=wparam	CASE WM_ENABLE		IF wparam=0 THEN			ControlData.ControlEnabled=FALSE		ELSE			ControlData.ControlEnabled=TRUE		END IF		INVALIDATERECT hwnd		PASSEVENT	CASE WM_DESTROY		DELETEOBJECT Brush		DELETEOBJECT Pen	CASE WM_LBUTTONDOWN		SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,4,hwnd	CASE WM_LBUTTONUP		SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,5,hwnd	CASE WM_RBUTTONDOWN		SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,6,hwnd	CASE WM_RBUTTONUP		SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,7,hwnd	CASE WM_MOUSEMOVE		MoveState=0		IF Capture=FALSE THEN			MoveState=1			SETCAPTURE hwnd			Capture=TRUE			CaptureDC=ControlDCTemp			CaptureRight=ControlData.ControlWidth			CaptureBottom=ControlData.ControlHeight		ELSE			IF CursorPosX<0 OR CursorPosX>CaptureRight OR CursorPosY<0 OR CursorPosY>CaptureBottom THEN				MoveState=2				RELEASECAPTURE				Capture=FALSE			END IF		END IF		INVALIDATERECT hwnd		IF MoveState=0 THEN			SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,3,hwnd		ELSE			IF MoveState=1 THEN				SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,1,hwnd			ELSE				SENDMESSAGE ControlData.ControlParent,OBM_MOUSE,2,hwnd			END IF		END IF	CASE WM_PAINT		BEGIN PAINT hwnd,PaintStruct		ControlDCTemp=STATUS		CALL SUB MakeRect		IF ControlData.ControlCallBackSet=TRUE THEN			CALL SUB [ControlData.ControlCallBack]		END IF			END PAINT hwnd,PaintStruct		RELEASEDC ControlData.ControlParent,ControlDCTemp	CASE OBM_SETBACKCOLOR		ControlData.ControlBackColor=wparam		INVALIDATERECT hwnd	CASE OBM_SETFORECOLOR		ControlData.ControlForeColor=wparam		INVALIDATERECT hwnd	CASE OBM_GETMOUSEX		ReturnValue=CursorPosX	CASE OBM_GETMOUSEY		ReturnValue=CursorPosY	CASE ELSE		PASSEVENTEND SELECTEND SUBBEGIN SUB GetInstanceVarsRectLeft=0RectTop=0RectRight=ControlData.ControlWidthRectBottom=ControlData.ControlHeightEND SUBBEGIN SUB MakeRectIF ControlData.ControlEnabled=TRUE THEN	CREATE Pen,SOLID,1,ControlData.ControlForeColor	CREATE Brush,ControlData.ControlBackColorELSE	CREATE Pen,SOLID,1,$c8d0d4	CREATE Brush,$c8d0d4END IFSELECTOBJECT ControlDCTemp,PenSELECTOBJECT ControlDCTemp,BrushRECTANGLE ControlDCTemp,0,0,ControlData.ControlWidth,ControlData.ControlHeightDELETEOBJECT PenDELETEOBJECT BrushEND SUBBEGIN SUB SetControlStyleEND SUBBEGIN FCN GetVersion(0)RETURN 100END FCN