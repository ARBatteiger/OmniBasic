TYPE ControlStruct	ControlHandle AS HANDLE	ControlInstance AS LONG	ControlID AS LONG	ControlDC AS LONG	ControlParent AS HANDLE	ControlText AS STRING*32	ControlLeft AS LONG	ControlTop AS LONG	ControlWidth AS LONG	ControlHeight AS LONG	ControlValue AS LONG	ControlStyle AS LONG	ControlExStyle AS LONG	ControlBackColor AS LONG	ControlForeColor AS LONG	ControlFont AS FONT	ControlBitmap AS BITMAP	ControlBitmapSet AS BOOLEAN	ControlColorSet AS BOOLEAN	ControlButtonDown AS BOOLEAN	ControlFontSet AS BOOLEANEND TYPEDIM ControlData AS ControlStruct VECTORDIM CreateData AS CreateStruct VECTORDIM StringPtr AS STRING VECTORDIM TempInt AS LONGdim x as longdim a as longdim q as longdim lf as longdim tp as longdim wd as longdim ht as longdim z as longdim ControlHandleTemp AS HANDLEdim ControlDCTemp AS DCDIM ControlFontTemp AS FONTDIM ControlBitmapTemp AS BITMAPdim MemDC AS DCDIM CompatBMP AS BITMAPdim ControlParentTemp AS HANDLEdeclare fcn getleft(integer) as integerdeclare fcn gettop(integer) as integerdeclare fcn getwidth(integer) as integerdeclare fcn getheight(integer) as integerdim pb1 as buttondim bg1 as rectangledim brush1 as solidbrushdim pen1 as pendim dctemp as longdim bool as booleanbegin export	getleft	gettop	getwidth	getheightend exportBEGIN SUB ProcessMsgselect case wmsg	case WM_CREATE		ControlData.ControlHandle=hwnd		ControlData.ControlInstance=CreateData.cshInstance		ControlData.ControlID=CreateData.cshMenu		ControlData.ControlParent=CreateData.cshwndParent		ControlData.ControlLeft=CreateData.csLeft		ControlData.ControlTop=CreateData.csTop		ControlData.ControlWidth=CreateData.csWidth		ControlData.ControlHeight=CreateData.csHeight		ControlData.ControlStyle=CreateData.csStyle		ControlData.ControlExStyle=CreateData.csExStyle		ControlData.ControlForeColor=0		lf=ControlData.ControlLeft		tp=ControlData.ControlTop		wd=ControlData.ControlWidth		ht=ControlData.ControlHeight				call sub GetInstanceVars				ControlData.ControlBackColor=$c8d0d4		;LF1.lfHeight=20		;LF1.lfFaceName="MS Sans Serif"				;ControlParentTemp=ControlData.ControlParent		;create pb1,lf,tp,wd,ht in ControlParentTemp		;call sub makerect		;create bg1,300,300,100,20		;create pb1,lf,tp,wd,ht in ControlParentTemp		;z=ControlData.ControlHandle		;invoke SendMessage,[z],0,[ControlParentHandle]		;pb1.text="Havis"	case WM_SETTEXT		call sub GetInstanceVars		SETVECTOR StringPtr=lparam		ControlData.ControlText=StringPtr		invoke InvalidateRect,[hwnd],0,1	case WM_GETTEXT		call sub GetInstanceVars		_IOBuffer=ControlData.ControlText	case OBM_SETBITMAP		call sub GetInstanceVars		ControlData.ControlBitmap=wparam		ControlData.ControlBitmapSet=TRUE		invoke InvalidateRect,[hwnd],0,1	case WM_SETFONT		call sub GetInstanceVars		ControlData.ControlFont=wparam		ControlData.ControlFontSet=TRUE		invoke InvalidateRect,[hwnd],0,1	case OBM_SETVALUE		call sub GetInstanceVars		ControlData.ControlValue=wparam	case OBM_GETVALUE		ReturnValue=ControlData.ControlValue	case WM_MOVE		call sub GetInstanceVars		if lparam<2000 then		invoke GetWindowRect,[ControlParentTemp],RectLeft		mov eax,[RectLeft]		mov [_ArgSafe0],eax		mov eax,[RectTop]		mov [_ArgSafe1],eax		invoke GetWindowRect,[hwnd],RectLeft		mov eax,[_ArgSafe0]		sub eax,[RectLeft]		mov [STATUS],eax		ControlData.ControlLeft=STATUS		mov eax,[_ArgSafe1]		sub [RectTop],eax		mov [STATUS],eax		ControlData.ControlTop=STATUS		call sub GetInstanceVars		invoke InvalidateRect,[hwnd],0,1		;bool=true		mov eax,0		end if				;invoke GetClientRect,[hwnd],RectLeft		;ControlData.ControlLeft=RectLeft		;ControlData.ControlTop=RectTop		;invoke InvalidateRect,[hwnd],0,1				;passevent	case WM_SIZE		call sub GetInstanceVars		case WM_ENABLE		call sub GetInstanceVars		invoke InvalidateRect,[hwnd],0,1		passevent	case WM_DESTROY		case WM_LBUTTONUP		call sub GetInstanceVars		ControlData.ControlButtonDown=false		invoke InvalidateRect,[hwnd],0,1		call sub makeclick		;call sub maketext		;call sub makerect	case WM_LBUTTONDOWN		call sub GetInstanceVars		ControlData.ControlButtonDown=TRUE		invoke InvalidateRect,[hwnd],0,1		;call sub maketext		;call sub makerect	case WM_MOUSEMOVE		;call sub GetInstanceVars		;if ControlData.ControlButtonDown=FALSE then		;	invoke DrawFrameControl,[ControlDCTemp],RectLeft,DFC_BUTTON,DFCS_BUTTONPUSH		;	call sub makerect		;	call sub maketext		;	call makebitmap		;end if		;passevent	case WM_PAINT		call sub GetInstanceVars		invoke BeginPaint,[hwnd],PaintStruct		mov [ControlDCTemp],eax		if ControlData.ControlButtonDown=FALSE then			invoke DrawFrameControl,[ControlDCTemp],RectLeft,DFC_BUTTON,DFCS_BUTTONPUSH;+DFCS_FLAT		else			invoke DrawFrameControl,[ControlDCTemp],RectLeft,DFC_BUTTON,DFCS_BUTTONPUSH+DFCS_PUSHED		end if		call sub makerect		call sub maketext		call makebitmap		invoke EndPaint,[hwnd],PaintStruct		RELEASEDC ControlParentTemp,ControlDCTemp	case OBM_SETBACKCOLOR		call sub GetInstanceVars		ControlData.ControlBackColor=wparam		invoke InvalidateRect,[hwnd],0,1	case OBM_SETFORECOLOR		call sub GetInstanceVars		ControlData.ControlForeColor=wparam		invoke InvalidateRect,[hwnd],0,1	case else		passeventend select;invoke ReleaseDC,[ControlDCTemp]END SUBbegin sub GetInstanceVarsControlFontTemp=ControlData.ControlFontControlParentTemp=ControlData.ControlParentControlBitmapTemp=ControlData.ControlBitmap;invoke GetDC,[hwnd],[ControlDCTemp];GETDC ControlParentTemp,ControlDCTemplf=ControlData.ControlLefttp=ControlData.ControlTopwd=ControlData.ControlWidthht=ControlData.ControlHeightRectLeft=0;lfRectTop=0;tpRectRight=wd;lf+wdRectBottom=ht;tp+htend subbegin sub makeclicksendcommand ControlParentTemp,ControlData.ControlID,0,hwndend subbegin sub makerectcreate pen1,solid,1,ControlData.ControlBackColorcreate brush1,ControlData.ControlBackColorSelectObject ControlDCTemp,pen1SelectObject ControlDCTemp,brush1Rectangle ControlDCTemp,2,2,wd-2,ht-2;Rectangle ControlDCTemp,lf+2,tp+2,lf+wd-2,tp+ht-2deleteobject pen1deleteobject brush1end subbegin sub maketextIF ControlData.ControlFontSet=TRUE THEN	selectobject ControlDCTemp,ControlFontTempEND IFsettextcolor ControlDCTemp,ControlData.ControlForeColorinvoke SetBkMode,[ControlDCTemp],TRANSPARENT;moveto ControlDCTemp,50,0IF ControlData.ControlButtonDown=FALSE THEN	TempInt=2ELSE	TempInt=0END IFdrawtext ControlDCTemp,TempInt,TempInt,wd-2,ht-2,ControlData.ControlText,1;drawtext ControlDCTemp,lf+TempInt,tp+TempInt,lf+wd-2,tp+ht-2,ControlData.ControlText,1end subbegin sub makebitmapIF ControlData.ControlBitmapSet=TRUE THEN	invoke CreateCompatibleDC,[ControlDCTemp]	mov [MemDC],eax	SelectObject MemDC,ControlBitmapTemp	IF ControlData.ControlButtonDown=FALSE THEN		TempInt=2	ELSE		TempInt=0	END IF	BITBLT ControlDCTemp,MemDC,TempInt,TempInt,wd,ht	invoke DeleteDC,[MemDC]END IFend subbegin fcn getleft(x)return lfend fcnbegin fcn gettop(x)return tpend fcnbegin fcn getwidth(x)return wdend fcnbegin fcn getheight(x)return htend fcn